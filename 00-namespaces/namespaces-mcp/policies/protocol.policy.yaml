# Protocol Module Policy
# Defines access control and governance rules

version: "2.0.0"
semantic_role: policy_definitions
artifact_type: policy
semantic_root: false

access_control:
  rbac:
    roles:
      - name: "protocol.admin"
        description: "Full access to protocol module"
        permissions:
          - "protocol:*"
      
      - name: "protocol.handler"
        description: "Can handle JSON-RPC requests"
        permissions:
          - "protocol:handleRequest"
          - "protocol:handleBatch"
          - "protocol:validate"
      
      - name: "protocol.transport"
        description: "Can send/receive messages"
        permissions:
          - "protocol:send"
          - "protocol:receive"
      
      - name: "protocol.viewer"
        description: "Read-only access"
        permissions:
          - "protocol:list"
          - "protocol:stats"

  permissions:
    - id: "protocol:handleRequest"
      description: "Handle JSON-RPC requests"
      resource: "jsonrpc/*"
      actions: ["handle"]
    
    - id: "protocol:handleBatch"
      description: "Handle batch requests"
      resource: "jsonrpc/batch"
      actions: ["handle"]
    
    - id: "protocol:validate"
      description: "Validate protocol messages"
      resource: "protocol/*"
      actions: ["validate"]
    
    - id: "protocol:send"
      description: "Send messages via transport"
      resource: "transport/*"
      actions: ["send"]
    
    - id: "protocol:receive"
      description: "Receive messages via transport"
      resource: "transport/*"
      actions: ["receive"]

governance_rules:
  request_size:
    max_size: "10MB"
    enforcement: "strict"
    action: "reject"
  
  batch_size:
    max_requests: 100
    enforcement: "strict"
    action: "reject"
  
  method_naming:
    pattern: "^[a-zA-Z][a-zA-Z0-9_/]*$"
    enforcement: "strict"
    action: "reject"
  
  timeout:
    default: "30s"
    max: "300s"
    enforcement: "soft"
  
  retry_limit:
    max_attempts: 3
    enforcement: "soft"
    action: "warn"

rate_limiting:
  requests:
    rate: "5000/s"
    burst: 10000
    scope: "per_user"
  
  batch_requests:
    rate: "500/s"
    burst: 1000
    scope: "per_user"

security_policies:
  encryption:
    in_transit: true
    at_rest: false
    algorithm: "TLS-1.3"
  
  authentication:
    required: true
    methods:
      - "oauth2"
      - "api_key"
      - "jwt"
  
  authorization:
    model: "rbac"
    default_deny: true
  
  audit:
    enabled: true
    events:
      - "handleRequest"
      - "handleBatch"
      - "send"
      - "receive"
      - "validate"
    retention: "90d"

compliance:
  gdpr:
    enabled: true
    data_retention: "30d"
  
  hipaa:
    enabled: false
  
  pci_dss:
    enabled: false

monitoring:
  metrics:
    - "request_count"
    - "batch_count"
    - "error_rate"
    - "latency_p99"
    - "throughput"
  
  alerts:
    - condition: "error_rate > 0.05"
      severity: "critical"
      action: "notify"
    
    - condition: "latency_p99 > 50ms"
      severity: "warning"
      action: "notify"
    
    - condition: "throughput < 1000"
      severity: "warning"
      action: "notify"

metadata:
  created_at: "2025-01-10T14:00:00Z"
  updated_at: "2025-01-10T14:00:00Z"
  version: "2.0.0"
  status: "active"
  references:
    - "protocol.manifest.yaml"
    - "protocol.spec.yaml"
    - "naming-registry.yaml"