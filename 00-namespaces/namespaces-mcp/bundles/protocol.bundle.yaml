# Protocol Module Bundle
# Groups related artifacts for deployment

version: "2.0.0"
semantic_role: artifact_bundles
artifact_type: bundle
semantic_root: false

bundle:
  name: "protocol"
  version: "1.0.0"
  description: "Protocol layer deployment bundle"
  type: "module"

artifacts:
  manifest:
    path: "manifests/protocol.manifest.yaml"
    type: "manifest"
    required: true
    checksum: "sha256:..."
  
  schema:
    path: "schemas/protocol.schema.yaml"
    type: "schema"
    required: true
    checksum: "sha256:..."
  
  spec:
    path: "specs/protocol.spec.yaml"
    type: "spec"
    required: true
    checksum: "sha256:..."
  
  policy:
    path: "policies/protocol.policy.yaml"
    type: "policy"
    required: false
    checksum: "sha256:..."

source_code:
  - path: "src/protocol/json-rpc-handler.ts"
    type: "typescript"
    checksum: "sha256:..."
  
  - path: "src/protocol/transport-layer.ts"
    type: "typescript"
    checksum: "sha256:..."
  
  - path: "src/protocol/protocol-validator.ts"
    type: "typescript"
    checksum: "sha256:..."
  
  - path: "src/protocol/message-router.ts"
    type: "typescript"
    checksum: "sha256:..."
  
  - path: "src/protocol/index.ts"
    type: "typescript"
    checksum: "sha256:..."

dependencies:
  runtime:
    - name: "nodejs"
      version: ">=18.0.0"
    
    - name: "typescript"
      version: "^5.0.0"
  
  modules:
    - name: "communication"
      version: "^1.0.0"
      artifact: "communication.bundle.yaml"
  
  npm_packages:
    - name: "uuid"
      version: "^9.0.0"
    
    - name: "ajv"
      version: "^8.0.0"

deployment:
  target_environments:
    - "development"
    - "staging"
    - "production"
  
  configuration:
    development:
      json_rpc_version: "2.0"
      max_request_size: "1MB"
      timeout: "10s"
      log_level: "debug"
    
    staging:
      json_rpc_version: "2.0"
      max_request_size: "5MB"
      timeout: "30s"
      log_level: "info"
    
    production:
      json_rpc_version: "2.0"
      max_request_size: "10MB"
      timeout: "30s"
      log_level: "warn"
  
  health_checks:
    - type: "http"
      endpoint: "/health"
      interval: "30s"
      timeout: "5s"
    
    - type: "tcp"
      port: 8080
      interval: "10s"
  
  resources:
    development:
      cpu: "500m"
      memory: "256Mi"
    
    staging:
      cpu: "1000m"
      memory: "512Mi"
    
    production:
      cpu: "2000m"
      memory: "1Gi"

validation:
  pre_deployment:
    - check: "artifact_integrity"
      description: "Verify artifact checksums"
    
    - check: "dependency_resolution"
      description: "Ensure all dependencies are available"
    
    - check: "schema_validation"
      description: "Validate against schema"
    
    - check: "policy_compliance"
      description: "Check policy compliance"
    
    - check: "communication_dependency"
      description: "Verify communication module is available"
  
  post_deployment:
    - check: "health_check"
      description: "Verify service health"
    
    - check: "smoke_test"
      description: "Run basic functionality tests"
    
    - check: "performance_test"
      description: "Verify performance targets"
    
    - check: "integration_test"
      description: "Test integration with communication layer"

rollback:
  enabled: true
  automatic: true
  conditions:
    - "health_check_failed"
    - "error_rate > 0.05"
    - "latency_p99 > 100ms"
  
  strategy: "immediate"
  previous_version: "0.9.0"

metadata:
  created_at: "2025-01-10T14:00:00Z"
  updated_at: "2025-01-10T14:00:00Z"
  version: "2.0.0"
  status: "active"
  references:
    - "protocol.manifest.yaml"
    - "protocol.spec.yaml"
    - "protocol.policy.yaml"
    - "communication.bundle.yaml"
    - "endpoints.yaml"