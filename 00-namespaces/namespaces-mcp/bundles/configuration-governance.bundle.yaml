version: "2.0.0"
semantic_role: deployment_bundle
artifact_type: bundle
semantic_root: false
module: configuration-governance

description: |
  Complete deployment bundle for the Configuration & Governance module.
  Includes all source files, dependencies, configuration, and deployment
  strategies for policy engine, compliance, access control, and deployments.

# ============================================================================
# COMPONENT INVENTORY
# ============================================================================

components:
  # Policy Engine (2 files)
  policy:
    - path: "src/governance/policy/policy-engine.ts"
      type: "implementation"
      size: "28.3 KB"
      lines: 805
      exports: ["PolicyEngine", "IPolicyEngine"]
      
    - path: "src/configuration/policy-engine.ts"
      type: "implementation"
      size: "24.7 KB"
      lines: 702
      exports: ["PolicyEngine"]
      
  # Compliance & Audit (2 files)
  compliance:
    - path: "src/governance/compliance/compliance-checker.ts"
      type: "implementation"
      size: "32.1 KB"
      lines: 915
      exports: ["ComplianceChecker", "IComplianceChecker"]
      
    - path: "src/governance/audit/audit-manager.ts"
      type: "implementation"
      size: "26.8 KB"
      lines: 763
      exports: ["AuditManager", "IAuditManager"]
      
  # Access Control (1 file)
  access:
    - path: "src/configuration/access-control.ts"
      type: "implementation"
      size: "29.5 KB"
      lines: 840
      exports: ["AccessControl", "IAccessControl"]
      
  # Configuration Management (1 file)
  config:
    - path: "src/configuration/dynamic-config.ts"
      type: "implementation"
      size: "27.2 KB"
      lines: 774
      exports: ["DynamicConfig", "IConfigurationManager"]
      
  # Deployment Governance (2 files)
  deployment:
    - path: "src/governance/deployment/deployment-pipeline.ts"
      type: "implementation"
      size: "35.6 KB"
      lines: 1013
      exports: ["DeploymentPipeline", "IDeploymentGovernance"]
      
    - path: "src/governance/dashboard/governance-dashboard.ts"
      type: "implementation"
      size: "30.4 KB"
      lines: 865
      exports: ["GovernanceDashboard", "IGovernanceDashboard"]
      
  # Index & Exports (2 files)
  index:
    - path: "src/governance/index.ts"
      type: "barrel"
      size: "4.2 KB"
      lines: 120
      exports: ["*"]
      
    - path: "src/configuration/index.ts"
      type: "barrel"
      size: "3.8 KB"
      lines: 108
      exports: ["*"]

# ============================================================================
# DEPENDENCIES
# ============================================================================

dependencies:
  internal:
    - module: "@mcp/protocol"
      version: "^2.0.0"
      components: ["Request", "Response", "ErrorHandler"]
      
    - module: "@mcp/monitoring-observability"
      version: "^2.0.0"
      components: ["AuditLogger", "MetricsCollector"]
      
  external:
    runtime:
      - name: "casbin"
        version: "^5.26.0"
        purpose: "Access control enforcement"
        
      - name: "ajv"
        version: "^8.12.0"
        purpose: "JSON Schema validation"
        
      - name: "node-vault"
        version: "^0.10.2"
        purpose: "Secrets management"
        
      - name: "express"
        version: "^4.18.0"
        purpose: "Dashboard HTTP server"
        
      - name: "jsonwebtoken"
        version: "^9.0.0"
        purpose: "JWT token handling"
        
      - name: "bcrypt"
        version: "^5.1.0"
        purpose: "Password hashing"
        
    development:
      - name: "@types/node"
        version: "^20.0.0"
        
      - name: "@types/express"
        version: "^4.17.0"
        
      - name: "@types/jsonwebtoken"
        version: "^9.0.0"

# ============================================================================
# DEPLOYMENT CONFIGURATION
# ============================================================================

deployment:
  strategy:
    type: "blue-green"
    health_check_grace_period: 60
    
  replicas:
    min: 2
    max: 8
    target_cpu: 70
    target_memory: 80
    
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      cpu: "2000m"
      memory: "4Gi"
      
  health_checks:
    liveness:
      path: "/health/live"
      interval: 10
      timeout: 5
      failure_threshold: 3
      
    readiness:
      path: "/health/ready"
      interval: 5
      timeout: 3
      failure_threshold: 2
      
  environment:
    - name: "NODE_ENV"
      value: "production"
      
    - name: "LOG_LEVEL"
      value: "info"
      
    - name: "POLICY_CACHE_TTL"
      value: "300"
      
    - name: "ACCESS_CACHE_TTL"
      value: "300"
      
    - name: "COMPLIANCE_SCAN_INTERVAL"
      value: "86400"  # 24 hours
      
    - name: "AUDIT_RETENTION_DAYS"
      value: "2555"  # 7 years

# ============================================================================
# VALIDATION
# ============================================================================

validation:
  pre_deployment:
    - name: "type_check"
      command: "tsc --noEmit"
      required: true
      
    - name: "lint"
      command: "eslint src/governance/**/*.ts src/configuration/**/*.ts"
      required: true
      
    - name: "unit_tests"
      command: "jest src/governance src/configuration"
      required: true
      coverage_threshold: 90
      
    - name: "integration_tests"
      command: "jest --testPathPattern=integration"
      required: true
      
    - name: "security_scan"
      command: "npm audit --audit-level=moderate"
      required: true
      
  post_deployment:
    - name: "health_check"
      endpoint: "/health"
      expected_status: 200
      timeout: 30
      
    - name: "policy_evaluation_test"
      endpoint: "/api/v1/policies/evaluate"
      method: "POST"
      expected_status: 200
      timeout: 10
      
    - name: "access_check_test"
      endpoint: "/api/v1/access/check"
      method: "POST"
      expected_status: 200
      timeout: 10
      
    - name: "smoke_tests"
      command: "npm run test:smoke"
      required: true

# ============================================================================
# ROLLBACK CONFIGURATION
# ============================================================================

rollback:
  automatic:
    enabled: true
    conditions:
      - "health_check_failure > 3"
      - "error_rate > 5%"
      - "policy_evaluation_p99 > 50ms"
      - "access_check_p99 > 50ms"
      
  manual:
    retention: 10  # Keep last 10 versions
    
  strategy:
    type: "instant"
    verification_time: 120  # seconds

# ============================================================================
# MONITORING & OBSERVABILITY
# ============================================================================

monitoring:
  metrics:
    - name: "governance_policy_evaluations_total"
      type: "counter"
      labels: ["policy_id", "decision"]
      
    - name: "governance_policy_evaluation_duration_seconds"
      type: "histogram"
      labels: ["policy_id"]
      buckets: [0.001, 0.005, 0.01, 0.02, 0.05, 0.1]
      
    - name: "governance_access_checks_total"
      type: "counter"
      labels: ["principal", "resource", "decision"]
      
    - name: "governance_compliance_score"
      type: "gauge"
      labels: ["framework"]
      
    - name: "governance_violations_total"
      type: "counter"
      labels: ["framework", "severity"]
      
    - name: "governance_deployments_total"
      type: "counter"
      labels: ["environment", "status"]
      
  alerts:
    - name: "HighPolicyEvaluationLatency"
      condition: "p99_latency > 50ms"
      duration: "5m"
      severity: "warning"
      
    - name: "LowComplianceScore"
      condition: "compliance_score < 80"
      duration: "1m"
      severity: "critical"
      
    - name: "CriticalViolation"
      condition: "critical_violations > 0"
      duration: "1m"
      severity: "critical"
      
    - name: "UnauthorizedAccessAttempt"
      condition: "unauthorized_attempts > 10"
      duration: "5m"
      severity: "high"

# ============================================================================
# CONFIGURATION
# ============================================================================

configuration:
  files:
    - path: "config/governance.yaml"
      type: "yaml"
      required: true
      
    - path: "config/policies.yaml"
      type: "yaml"
      required: true
      
    - path: "config/compliance.yaml"
      type: "yaml"
      required: true
      
    - path: "config/rbac.yaml"
      type: "yaml"
      required: true
      
  secrets:
    - name: "vault-credentials"
      keys: ["token", "address"]
      
    - name: "jwt-secret"
      keys: ["secret_key"]
      
    - name: "encryption-keys"
      keys: ["master_key", "data_key"]

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

security:
  tls:
    enabled: true
    cert_path: "/etc/tls/cert.pem"
    key_path: "/etc/tls/key.pem"
    
  authentication:
    methods: ["oauth2", "jwt"]
    jwt_expiry: "8h"
    
  authorization:
    model: "rbac"
    policy_path: "/etc/casbin/policy.csv"
    
  encryption:
    algorithm: "AES-256-GCM"
    key_rotation: "90d"

# ============================================================================
# BACKUP & RECOVERY
# ============================================================================

backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: "30d"
  
  components:
    - "policies"
    - "roles"
    - "configurations"
    - "audit_logs"
    
  storage:
    type: "s3"
    bucket: "governance-backups"
    encryption: true

# ============================================================================
# METADATA
# ============================================================================

metadata:
  created_at: "2025-01-10T14:00:00Z"
  updated_at: "2025-01-11T10:30:00Z"
  version: "2.0.0"
  status: "active"
  total_components: 10
  total_size: "242 KB"
  total_lines: 6905
  layers: 5
  maintainer: "MachineNativeOps Team"
  
build_info:
  build_time: "< 3 minutes"
  bundle_size: "~3 MB (minified)"
  dependencies_size: "~60 MB"