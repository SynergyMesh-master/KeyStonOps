# Workspace Directory Mapping
# Maps workspace directories to their purposes and policies

apiVersion: machinenativeops.io/v2
kind: Configuration
metadata:
  name: workspace-map
  namespace: machinenativeops
  labels:
    machinenativeops.io/component: controlplane
    machinenativeops.io/layer: baseline
    machinenativeops.io/type: configuration
  annotations:
    machinenativeops.io/description: "Workspace directory structure and mapping"
    machinenativeops.io/version: "v1.0.0"
    machinenativeops.io/immutable: "true"

spec:
  # Workspace root directory
  workspaceRoot: "./workspace"
  
  # Primary workspace directories
  directories:
    # Source code directory
    srcRoot: "./workspace/src"
    srcPurpose: "Source code and scripts"
    srcWritable: true
    srcSubdirectories:
      core: "./workspace/src/core"
      agents: "./workspace/src/agents"
      tooling: "./workspace/src/tooling"
      adapters: "./workspace/src/adapters"
      scripts: "./workspace/src/scripts"
      bin: "./workspace/src/bin"
    
    # Tooling directory (development tools, NOT governance validators)
    toolingRoot: "./workspace/src/tooling"
    toolingPurpose: "Development tools that CALL controlplane validators"
    toolingWritable: true
    toolingNote: "Tools can CALL controlplane validators but not replace them"
    
    # ChatOps directory
    chatopsRoot: "./workspace/chatops"
    chatopsPurpose: "ChatOps automation framework"
    chatopsWritable: true
    chatopsSubdirectories:
      commands: "./workspace/chatops/commands"
      workflows: "./workspace/chatops/workflows"
      routing: "./workspace/chatops/routing"
      runbooks: "./workspace/chatops/runbooks"
      policies: "./workspace/chatops/policies"
      adapters: "./workspace/chatops/adapters"
    
    # Services directory
    servicesRoot: "./workspace/services"
    servicesPurpose: "Service implementations"
    servicesWritable: true
    servicesSubdirectories:
      gateway: "./workspace/services/gateway"
      connectors: "./workspace/services/connectors"
      baselines: "./workspace/services/baselines"
      core: "./workspace/services/core"
    
    # Shared libraries directory
    sharedRoot: "./workspace/shared"
    sharedPurpose: "Shared libraries and utilities"
    sharedWritable: true
    sharedSubdirectories:
      schema: "./workspace/shared/schema"
      types: "./workspace/shared/types"
      utils: "./workspace/shared/utils"
      contracts: "./workspace/shared/contracts"
    
    # Database directory
    dbRoot: "./workspace/db"
    dbPurpose: "Database files"
    dbWritable: true
    dbSubdirectories:
      migrations: "./workspace/db/migrations"
      seeds: "./workspace/db/seeds"
      configs: "./workspace/db/configs"
    
    # Runtime directory
    runtimeRoot: "./workspace/runtime"
    runtimePurpose: "Runtime outputs (logs, tmp, cache, artifacts)"
    runtimeWritable: true
    runtimeSubdirectories:
      logs: "./workspace/runtime/logs"
      tmp: "./workspace/runtime/tmp"
      cache: "./workspace/runtime/cache"
      artifacts: "./workspace/runtime/artifacts"
    
    # Configuration directory
    configRoot: "./workspace/config"
    configPurpose: "Application configurations"
    configWritable: true
    
    # Documentation directory
    docsRoot: "./workspace/docs"
    docsPurpose: "Documentation"
    docsWritable: true
    
    # Tests directory
    testsRoot: "./workspace/tests"
    testsPurpose: "Test files"
    testsWritable: true
    
    # Deployment directory
    deployRoot: "./workspace/deploy"
    deployPurpose: "Deployment configurations"
    deployWritable: true
    
    # Operations directory
    opsRoot: "./workspace/ops"
    opsPurpose: "Operations files"
    opsWritable: true
    
    # Archive directory
    archiveRoot: "./workspace/archive"
    archivePurpose: "Archived content"
    archiveWritable: true
    
    # Private directory
    privateRoot: "./workspace/private"
    privatePurpose: "Private configurations"
    privateWritable: true
  
  # Write policies
  writePolicies:
    immutable:
      description: "Cannot be modified"
      paths: []
    
    restricted:
      description: "Requires elevated permissions"
      paths: []
    
    writable:
      description: "Open for general writes"
      paths:
        - "./workspace/**"
  
  # Directory purposes and boundaries
  boundaries:
    governance:
      description: "Governance files must NOT be in workspace"
      prohibited:
        - "Specifications (must be in controlplane/baseline/specifications/)"
        - "Registries (must be in controlplane/baseline/registries/)"
        - "Authoritative validators (must be in controlplane/baseline/validation/)"
        - "Gate rules (must be in controlplane/baseline/validation/)"
    
    tooling:
      description: "Development tools can CALL but not REPLACE controlplane validators"
      allowed:
        - "Wrapper scripts that call controlplane validators"
        - "Development utilities"
        - "Build tools"
        - "Testing utilities"
      prohibited:
        - "Governance validators (must be in controlplane/baseline/validation/)"
        - "Specifications (must be in controlplane/baseline/specifications/)"
        - "Any tool that replaces controlplane validators"
    
    runtime:
      description: "Runtime outputs must go to designated locations"
      allowed:
        - "./workspace/runtime/logs/"
        - "./workspace/runtime/tmp/"
        - "./workspace/runtime/cache/"
        - "./workspace/runtime/artifacts/"
        - "/var/log/"
        - "/var/run/"
        - "/var/cache/"
        - "/tmp/"
      prohibited:
        - "Runtime data in controlplane/baseline/ (immutable)"
        - "Runtime data in root directory"
  
  # Namespace mappings
  namespaceMappings:
    - namespace: "workspace"
      directory: "./workspace"
      writable: true
    
    - namespace: "workspace.src"
      directory: "./workspace/src"
      writable: true
    
    - namespace: "workspace.tooling"
      directory: "./workspace/src/tooling"
      writable: true
      note: "Tools can CALL controlplane validators but not replace them"
    
    - namespace: "workspace.chatops"
      directory: "./workspace/chatops"
      writable: true
    
    - namespace: "workspace.runtime"
      directory: "./workspace/runtime"
      writable: true
    
    - namespace: "workspace.config"
      directory: "./workspace/config"
      writable: true